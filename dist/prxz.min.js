!function(){"use strict";const e={isEmptyValue:e=>null==e||""===e||Array.isArray(e)&&0===e.length,isObject:e=>"object"==typeof e&&null!==e&&!Array.isArray(e),isSpecialNumber:e=>isNaN(e)||!isFinite(e),isInteger:e=>Number.isInteger(e),isScientificNotationNeeded:e=>{const t=Math.abs(e);return t>1e15||t>0&&t<1e-6||t>Number.MAX_SAFE_INTEGER||t===1/0},isNegativeZero:e=>0===e&&1/e==-1/0,isNumericString:e=>{const t=e.trim().replace(/[\s\u00A0\u202F,]/g,"");return!isNaN(t)&&!isNaN(parseFloat(t))}},t={normalizeDigits:e=>e.replace(/[٠-۹०-९০-৯੦-੯૦-૯୦-୯௦-௯౦-౯೦-೯൦-൯๐-๙໐-໙၀-၉០-៩]/g,e=>t.digitMap[e]||e),normalizeFullWidth:e=>e.replace(/[０-９．]/g,e=>"．"===e?".":String.fromCharCode(e.charCodeAt(0)-65248)),cleanNumberString:e=>{let r=e.trim();return r=r.replace(/[\u00A0\u2009\u202F\u205F]/g," "),r=t.normalizeDigits(r),r=t.normalizeFullWidth(r),r=r.replace(/[^\d.,+\-Ee\s]/g,""),r=r.replace(/\s/g,""),r},parseSeparators:e=>{if(e.includes("."))e=e.replace(/,/g,"");else{const t=(e.match(/,/g)||[]).length;if(t>0)if(1===t)e=e.replace(",",".");else{const t=e.lastIndexOf(",");e=e.substring(0,t).replace(/,/g,"")+"."+e.substring(t+1)}}return e},parseNumberFromString:e=>{const r=t.cleanNumberString(e),o=t.parseSeparators(r),n=o.split(".");if(n.length>1){const e=n[0]+"."+n.slice(1).join("");return parseFloat(e)}return parseFloat(o)}},r={narrowNoBreakSpace:" ",determineDecimals:(t,r)=>{if("number"==typeof r)return{min:r,max:r};if(e.isScientificNotationNeeded(t))return{scientific:!0};const o=Math.abs(t);if(o>0&&o<.001){const e=t.toString();if(e.includes("e-")){const[t,r]=e.split("e-"),o=t.replace(".","").search(/[1-9]/),n=parseInt(r)+o-1;return{min:n+2,max:n+2}}if(e.includes(".")){const t=e.split(".")[1].length;return{min:t,max:t}}}if(e.isInteger(t))return{min:0,max:0};const n=t.toString();let s=n.includes(".")?n.split(".")[1]:"";s=s.replace(/0+$/,"");const a=s.length;return a<=2?{min:a,max:a}:a<=6?{min:2,max:Math.min(a,6)}:{min:2,max:6}},formatScientific:e=>{const t=Math.floor(Math.log10(Math.abs(e)));return(e/Math.pow(10,t)).toFixed(2)+"e"+t},formatWithLocale:(t,o,n=!0)=>{const s={minimumFractionDigits:o.min,maximumFractionDigits:o.max,useGrouping:n};let a=t.toLocaleString("ru-RU",s);return a=a.replace(/\s/g,r.narrowNoBreakSpace),(e.isNegativeZero(t)||a.startsWith("-0"))&&(a=a.substring(1)),a},formatWithoutLocale:(t,r)=>{let o;if(r.min===r.max)o=t.toFixed(r.min);else{const e=Math.pow(10,r.max);o=""+Math.round(t*e)/e}return o=o.replace(".",","),(e.isNegativeZero(t)||o.startsWith("-0"))&&(o=o.substring(1)),o}},{isEmptyValue:o,isObject:n,isSpecialNumber:s,isNumericString:a}=e,{parseNumberFromString:i}=t,{determineDecimals:l,formatScientific:c,formatWithLocale:u,formatWithoutLocale:d}=r,f={fval(e,t=2,r=!0){const f=(e,t,r,g=!1)=>{if(o(e))return"-";if(n(e))return g?(Object.keys(e).length,null):"[object]";if(Array.isArray(e)){if(g){if(0===e.length)return"-";const o=e.map(e=>{try{const o=f(e,t,r,!1);if("string"==typeof o){if("-"===o||"NaN"===o||"∞"===o||"-∞"===o||"[object]"===o)return o;const e=o.replace(/[^\d.,-]/g,"").replace(",","."),r=parseFloat(e);if(!isNaN(r)){if("auto"===t||void 0===t){const e=l(r,t);return e.scientific?c(r):parseFloat(r.toFixed(e.fixed))}if("number"==typeof t)return parseFloat(r.toFixed(t))}return o}if("number"==typeof o){if("auto"===t||void 0===t){const e=l(o,t);return e.scientific?c(o):parseFloat(o.toFixed(e.fixed))}if("number"==typeof t)return parseFloat(o.toFixed(t))}return o}catch(t){return console.warn("fval: ошибка обработки элемента массива:",e,t),"-"}});return o}if(0===e.length)return"-";for(let o=0;o<e.length;o++)try{const n=f(e[o],t,r,!1);if("-"!==n&&"[object]"!==n&&"NaN"!==n&&!n.includes("∞"))return n}catch(t){console.warn(`fval: ошибка обработки элемента массива [${o}]:`,e[o],t)}return"-"}let m;if("number"==typeof e)m=e;else if("boolean"==typeof e)m=e?1:0;else if("string"==typeof e){if(!a(e)&&/^[^\d.,+\-]/.test(e.trim()))return e.trim();if(m=i(e),isNaN(m))return"-"}else m=+e;if(s(m))return isNaN(m)?"NaN":m>0?"∞":"-∞";const p=Math.abs(m);let h=t;p>0&&p<.001&&"number"==typeof t&&(h="auto");const y=l(m,h);return y.scientific?c(m):r?u(m,y,Math.abs(m)>=1e3):d(m,y)};return f(e,t,r,!0)},fperc(e,t=2){if(o(e))return"-";if(n(e)&&!Array.isArray(e))return e+"%";if(Array.isArray(e)){if(0===e.length)return"-";for(let t=0;t<e.length;t++){const r=e[t];if(!o(r)){if(n(r)&&!Array.isArray(r))return r+"%";if(Array.isArray(r)){if(0===r.length)continue;const t=r[0];if(o(t))continue;e=t;break}e=r;break}}if(Array.isArray(e))return"-"}let r;if("number"==typeof e)r=e;else if("boolean"==typeof e)r=e?1:0;else if("string"==typeof e){if(!a(e)&&/^[^\d.,+\-]/.test(e.trim()))return e.trim();if(r=i(e),isNaN(r))return e.trim()}else r=+e;if(s(r))return isNaN(r)?"NaN%":r>0?"Infinity%":"-Infinity%";const l=(e=>{if("number"==typeof e)return Math.max(0,Math.min(100,Math.floor(e)));if("string"==typeof e){const t=parseInt(e,10);return Number.isNaN(t)?2:Math.max(0,Math.min(100,Math.floor(t)))}return 2})(t);if(0===l)return Math.round(r)+"%";const c=Math.pow(10,l);return(Math.round(r*c)/c).toFixed(l)+"%"},fmoney(e,t="RUB",r=2){if(null==e||""===e)return"-";const o=+e;if(isNaN(o))return e+"";if(o===1/0)return"Infinity";if(o===-1/0)return"-Infinity";if(!isFinite(o))return"NaN";const n={RUB:"₽",USD:"$",EUR:"€",GBP:"£",JPY:"¥"}[t]||t;let s=new Intl.NumberFormat("ru-RU",{minimumFractionDigits:r,maximumFractionDigits:r}).format(Math.abs(o));return s=s.replace(/\s/g," "),s=s.replace(/\./g,","),`${o<0?"-":""}${s} ${n}`},fshortval(e,t=2){if(null==e||""===e)return"-";const r=+e;if(isNaN(r))return e+"";if(!isFinite(r))return r>0?"Infinity":"-Infinity";const o=Math.abs(r);return o>=1e15?(r/1e15).toFixed(t)+" квадр":o>=1e12?(r/1e12).toFixed(t)+" трлн":o>=1e9?(r/1e9).toFixed(t)+" млрд":o>=1e6?(r/1e6).toFixed(t)+" млн":o>=1e3?(r/1e3).toFixed(t)+" тыс":r.toFixed(t)}},g={fdate(e,t="dd.mm.yyyy"){const{date:r,isValid:o}=function(e){if(!e)return{date:null,isValid:!1};const t=e instanceof Date?e:new Date(e),r=!isNaN(t.getTime());return{date:t,isValid:r}}(e);if(!o)return e?"Неверная дата":"-";const n=function(e){return new Date(e.getTime()+108e5)}(r);return function(e,t,r){const o=e.getUTCDate(),n=e.getUTCMonth(),s=e.getUTCFullYear(),a=e.getUTCDay(),i=e.getUTCHours(),l=e.getUTCMinutes(),c=e.getUTCSeconds(),u=i>=12,d=i%12||12,f={dd:o.toString().padStart(2,"0"),d:o.toString(),dddd:r.days.full[a],ddd:r.days.short[a],mm:(""+(n+1)).padStart(2,"0"),m:""+(n+1),mmmm:r.months.full[n],mmm:r.months.short[n],yyyy:s.toString(),yy:s.toString().slice(-2),HH:i.toString().padStart(2,"0"),H:i.toString(),hh:d.toString().padStart(2,"0"),h:d.toString(),MM:l.toString().padStart(2,"0"),M:l.toString(),SS:c.toString().padStart(2,"0"),S:c.toString(),tt:u?r.ampm.pm:r.ampm.am,t:u?"p":"a"};let g=t;const m={};g=g.replace(/\\([dmytHhMS])/g,(e,t)=>{const r=`__ESC${Date.now()}${Math.random()}__`;return m[r]=t,r}),g=g.replace(/\{date\}/g,`${f.dd}.${f.mm}.${f.yyyy}`),g=g.replace(/\{time:s\}/g,`${f.HH}:${f.MM}:${f.SS}`),g=g.replace(/\{time\}/g,`${f.HH}:${f.MM}`);const p=["dddd","ddd","dd","d","mmmm","mmm","mm","m","yyyy","yy","HH","H","hh","h","MM","M","SS","S","tt","t"];for(const e of p)g=g.replace(RegExp(e,"g"),f[e]);for(const[e,t]of Object.entries(m))g=g.replace(RegExp(e,"g"),t);return g}(n,t,{months:{short:["Янв","Фев","Мар","Апр","Май","Июн","Июл","Авг","Сен","Окт","Ноя","Дек"],full:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"]},days:{short:["Вс","Пн","Вт","Ср","Чт","Пт","Сб"],full:["Воскресенье","Понедельник","Вторник","Среда","Четверг","Пятница","Суббота"]},ampm:{am:"AM",pm:"PM"}})}},m={API_REQUEST:"background: #0057ff; color: white; padding: 2px 6px; border-radius: 3px",API_REQUEST_TEXT:"color: #0057ff",SUCCESS:"background: #4caf50; color: white; padding: 2px 6px; border-radius: 3px",SUCCESS_TEXT:"color: #4caf50",ERROR:"background: #f44336; color: white; padding: 2px 6px; border-radius: 3px",ERROR_TEXT:"color: #f44336",WARNING:"background: #ff9800; color: white; padding: 2px 6px; border-radius: 3px",WARNING_TEXT:"color: #ff9800",INFO:"background: #2196f3; color: white; padding: 2px 6px; border-radius: 3px",INFO_TEXT:"color: #2196f3",getStyleForStatus:e=>{switch(e.toLowerCase()){case"success":return{badge:m.SUCCESS,text:m.SUCCESS_TEXT};case"error":return{badge:m.ERROR,text:m.ERROR_TEXT};case"warning":return{badge:m.WARNING,text:m.WARNING_TEXT};case"info":default:return{badge:m.INFO,text:m.INFO_TEXT};case"debug":return{badge:"background: #9c27b0; color: white; padding: 2px 6px; border-radius: 3px",text:"color: #9c27b0"}}}};function p(e){try{const t=sessionStorage.getItem(e);return t?JSON.parse(t).access_token:null}catch(e){return console.log("Ошибка при получении токена:",e),null}}function h(e,t){return e.map(e=>{const r=t.filter(t=>t.dataset?.datasetId===e.id);return{sheduler:e,dashboards:r,dashboardCount:r.length}})}async function y(e,t){const r=[];for(let o=0;o<t.length;o++){const n=t[o];try{if(!n.isEnabled){r.push({...n,name:null,modifiedTime:null,modifiedBy:null});continue}o>0&&await new Promise(e=>setTimeout(e,20));const t=await fetch(`${moreInfoLink}${n.id}/model`,{method:"GET",headers:{Authorization:"Bearer "+e,"Content-Type":"application/json"}});if(t.ok){const e=await t.json();r.push({...n,name:e.name||null,modifiedTime:e.modifiedTime||null,modifiedBy:e.modifiedBy||null})}else console.warn("Не удалось получить дополнительную информацию для шедулера "+n.id),r.push({...n,name:null,modifiedTime:null,modifiedBy:null})}catch(e){console.error(`Ошибка при получении информации для шедулера ${n.id}:`,e),r.push({...n,name:null,modifiedTime:null,modifiedBy:null})}}return r}const S={version:"1.0.1",api:{visi:{final:{getMetricsMono:async function(){const e=function(){let e=window.location.href,t=new URL(e).hostname,r=e.split("&").find(e=>e.includes("workspaceId="));return r?r=r.split("=")[1]:console.log("workspaceId не найден"),{shedulersLink:"https://"+t+"/data-management-service/api/v1/workspaces/"+r+"/scheduled-refresh/GetAll",dashesLink:"https://"+t+"/dashboard-service/api/workspaces/"+r+"/dashboards",moreInfoLink:"https://"+t+"/formula-engine/api/v1/workspaces/"+r+"/datasets/",workspaceAllLink:"https://"+t+"/workspace-service/api/v1/evaluate-workspaces-with-role",keyPath:"oidc.user:https://"+t+"/keycloak/realms/Visiology:visiology_designer"}}(),{shedulersLink:t,dashesLink:r,moreInfoLink:o,keyPath:n}=e,s=p(n),[a,i,l]=await Promise.all([fetch(t,{method:"GET",headers:{Authorization:"Bearer "+s,"Content-Type":"application/json"}}).then(e=>{if(!e.ok)throw Error(`HTTP error! status: ${e.status}, name: responseShedulers`);return e}),fetch(r,{method:"GET",headers:{Authorization:"Bearer "+s,"Content-Type":"application/json"}}).then(e=>{if(!e.ok)throw Error(`HTTP error! status: ${e.status}, name: responseDashboards`);return e})]),[c,u]=await Promise.all([a.json(),i.json(),l?l.json():Promise.resolve(null)]),d=await y(s,c),f=h(d,u),g=function(e,t){return{deadshedulers:e.filter(e=>{const r=!0===e.isEnabled,o=t.some(t=>t.dataset?.datasetId===e.id);return r&&!o})}}(d,u);return{dataShedulers:d,dataDashboards:u,dataAll:f,deadshedulers:g}}},methods:{getAccessToken:p,getShedulersMore:y,groupDatasets:h}}},lg:{async api(e,t="GET",r=null,o={}){const n=(new Date).toISOString(),s="req_"+Math.random().toString(36).substr(2,9);return console.groupCollapsed(`%cAPI ${t}%c ${e}`,m.API_REQUEST,m.API_REQUEST_TEXT),console.log("Request ID:",s),console.log("Timestamp:",n),console.log("Method:",t),console.log("URL:",e),r&&Object.keys(r).length>0&&console.log("Request Data:",r),o.headers&&console.log("Headers:",o.headers),console.groupEnd(),fetch(e,{method:t,body:r?JSON.stringify(r):void 0,headers:{"Content-Type":"application/json",...o.headers},...o}).then(async r=>{const o=r.headers.get("content-type")?.includes("application/json"),a=o?await r.json():await r.text(),i=r.ok?"SUCCESS":"ERROR",l=m.getStyleForStatus(i);if(console.groupCollapsed(`%cAPI ${i}%c ${e}`,l.badge,l.text),console.log("Response ID:",s),console.log("Status:",`${r.status} ${r.statusText}`),console.log("Response Time:",Date.now()-new Date(n).getTime()+"ms"),console.log("Response Type:",o?"JSON":"TEXT"),o&&a?console.log("Response Data:",a):a&&console.log("Response Text:",a),console.groupEnd(),!r.ok)throw{status:r.status,statusText:r.statusText,data:a,url:e,method:t,requestId:s};return{data:a,status:r.status,headers:r.headers,requestId:s}}).catch(t=>{const r=m.getStyleForStatus("ERROR");throw console.groupCollapsed("%cAPI ERROR%c "+e,r.badge,r.text),console.log("Response ID:",s),console.log("Status:",t.status||"NETWORK_ERROR"),console.log("Total Time:",Date.now()-new Date(n).getTime()+"ms"),console.log("Error Details:",t),t.data&&console.log("Error Data:",t.data),console.groupEnd(),{...t,requestId:s,timestamp:n}})},log:{success(e,...t){const r=m.getStyleForStatus("SUCCESS");"string"==typeof e?console.log("%cSUCCESS%c "+e,r.badge,r.text,...t):console.log("%cSUCCESS",r.badge,e,...t)},error(e,...t){const r=m.getStyleForStatus("ERROR");"string"==typeof e?console.log("%cERROR%c "+e,r.badge,r.text,...t):console.log("%cERROR",r.badge,e,...t)},info(e,...t){const r=m.getStyleForStatus("INFO");"string"==typeof e?console.log("%cINFO%c "+e,r.badge,r.text,...t):console.log("%cINFO",r.badge,e,...t)},warn(e,...t){const r=m.getStyleForStatus("WARNING");"string"==typeof e?console.log("%cWARNING%c "+e,r.badge,r.text,...t):console.log("%cWARNING",r.badge,e,...t)},debug(e,...t){const r=m.getStyleForStatus("DEBUG");"string"==typeof e?console.log("%cDEBUG%c "+e,r.badge,r.text,...t):console.log("%cDEBUG",r.badge,e,...t)},object(e,t,r="INFO"){const o=m.getStyleForStatus(r);console.groupCollapsed(`%c${r}%c ${e}`,o.badge,o.text),console.log(t),console.groupEnd()}}},frm:{v:f,d:g}};"undefined"!=typeof window?window.prxz=S:"undefined"!=typeof global?global.prxz=S:"undefined"!=typeof self&&(self.prxz=S),"undefined"!=typeof module&&module.exports&&(module.exports=S),"function"==typeof define&&define.amd&&define([],function(){return S})}();