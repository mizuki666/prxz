!function(){"use strict";const t={fval(t,e=2,o=!0){if(null==t||""===t)return"-";const n=+t;return isNaN(n)?t+"":o?n.toLocaleString("ru-RU",{minimumFractionDigits:e,maximumFractionDigits:e}):n.toFixed(e)},fperc(t,e=2){if(null==t)return"-";const o=+t;return isNaN(o)?t+"":o.toFixed(e)+"%"},fmoney(t,e="RUB",o=2){if(null==t||""===t)return"-";const n=+t;return isNaN(n)?t+"":n.toLocaleString("ru-RU",{style:"currency",currency:e,minimumFractionDigits:o,maximumFractionDigits:o})},fshortval(t,e=2){if(null==t||""===t)return"-";const o=+t;if(isNaN(o))return t+"";const n=Math.abs(o);return n>=1e12?(o/1e12).toFixed(e)+" трлн":n>=1e9?(o/1e9).toFixed(e)+" млрд":n>=1e6?(o/1e6).toFixed(e)+" млн":n>=1e3?(o/1e3).toFixed(e)+" тыс":o.toFixed(e)}},e={formatDate(t,e="dd.mm.yyyy"){const{date:o,isValid:n}=this._parseDate(t);if(!n)return this._getFallbackValue(t);const a=this._convertToMoscowTime(o);return this._applyFormat(a,e)},_parseDate(t){if(!t)return{date:null,isValid:!1};const e=t instanceof Date?t:new Date(t),o=!isNaN(e.getTime());return{date:e,isValid:o}},_convertToMoscowTime:t=>new Date(t.getTime()+108e5),_getFallbackValue:t=>t?"Неверная дата":"-",_getLocalizedStrings:()=>({months:{short:["янв","фев","мар","апр","май","июн","июл","авг","сен","окт","ноя","дек"],full:["январь","февраль","март","апрель","май","июнь","июль","август","сентябрь","октябрь","ноябрь","декабрь"]},days:{short:["вс","пн","вт","ср","чт","пт","сб"],full:["воскресенье","понедельник","вторник","среда","четверг","пятница","суббота"]},ampm:{am:"AM",pm:"PM"}}),_applyFormat(t,e){const o=this._getLocalizedStrings(),n=t.getUTCDate(),a=t.getUTCMonth(),r=t.getUTCFullYear(),s=t.getUTCDay(),i=t.getUTCHours(),l=t.getUTCMinutes(),d=t.getUTCSeconds(),c=i>=12,u=i%12||12,g={d:n.toString(),dd:n.toString().padStart(2,"0"),ddd:o.days.short[s],dddd:o.days.full[s],m:""+(a+1),mm:(""+(a+1)).padStart(2,"0"),mmm:o.months.short[a],mmmm:o.months.full[a],yy:r.toString().slice(-2),yyyy:r.toString(),H:i.toString(),HH:i.toString().padStart(2,"0"),h:u.toString(),hh:u.toString().padStart(2,"0"),M:l.toString(),MM:l.toString().padStart(2,"0"),S:d.toString(),SS:d.toString().padStart(2,"0"),t:c?"p":"a",tt:c?o.ampm.pm:o.ampm.am,"\\{date\\}":`${n.toString().padStart(2,"0")}.${(""+(a+1)).padStart(2,"0")}.${r}`,"\\{time\\}":`${i.toString().padStart(2,"0")}:${l.toString().padStart(2,"0")}`,"\\{time:s\\}":`${i.toString().padStart(2,"0")}:${l.toString().padStart(2,"0")}:${d.toString().padStart(2,"0")}`};let m=e;(m.includes("{date}")||m.includes("{time}"))&&(m=m.replace("{date}",g["\\{date\\}"]).replace("{time:s}",g["\\{time:s\\}"]).replace("{time}",g["\\{time\\}"]));return m.replace(/d{1,4}|m{1,4}|y{2,4}|H{1,2}|h{1,2}|M{1,2}|S{1,2}|t{1,2}|\\[dmyt]/g,t=>t.startsWith("\\")?t.slice(1):g[t]||t)}},o={API_REQUEST:"background: #0057ff; color: white; padding: 2px 6px; border-radius: 3px",API_REQUEST_TEXT:"color: #0057ff",SUCCESS:"background: #4caf50; color: white; padding: 2px 6px; border-radius: 3px",SUCCESS_TEXT:"color: #4caf50",ERROR:"background: #f44336; color: white; padding: 2px 6px; border-radius: 3px",ERROR_TEXT:"color: #f44336",WARNING:"background: #ff9800; color: white; padding: 2px 6px; border-radius: 3px",WARNING_TEXT:"color: #ff9800",INFO:"background: #2196f3; color: white; padding: 2px 6px; border-radius: 3px",INFO_TEXT:"color: #2196f3",getStyleForStatus:t=>{switch(t.toLowerCase()){case"success":return{badge:o.SUCCESS,text:o.SUCCESS_TEXT};case"error":return{badge:o.ERROR,text:o.ERROR_TEXT};case"warning":return{badge:o.WARNING,text:o.WARNING_TEXT};case"info":default:return{badge:o.INFO,text:o.INFO_TEXT};case"debug":return{badge:"background: #9c27b0; color: white; padding: 2px 6px; border-radius: 3px",text:"color: #9c27b0"}}}};function n(t){try{const e=sessionStorage.getItem(t);return e?JSON.parse(e).access_token:null}catch(t){return console.log("Ошибка при получении токена:",t),null}}async function a(t,e){const o=[];for(let n=0;n<e.length;n++){const a=e[n];try{if(!a.isEnabled){o.push({...a,name:null,modifiedTime:null,modifiedBy:null});continue}n>0&&await new Promise(t=>setTimeout(t,20));const e=await fetch(`${moreInfoLink}${a.id}/model`,{method:"GET",headers:{Authorization:"Bearer "+t,"Content-Type":"application/json"}});if(e.ok){const t=await e.json();o.push({...a,name:t.name||null,modifiedTime:t.modifiedTime||null,modifiedBy:t.modifiedBy||null})}else console.warn("Не удалось получить дополнительную информацию для шедулера "+a.id),o.push({...a,name:null,modifiedTime:null,modifiedBy:null})}catch(t){console.error(`Ошибка при получении информации для шедулера ${a.id}:`,t),o.push({...a,name:null,modifiedTime:null,modifiedBy:null})}}return o}function r(t,e){return t.map(t=>{const o=e.filter(e=>e.dataset?.datasetId===t.id);return{sheduler:t,dashboards:o,dashboardCount:o.length}})}const s={final:{getMetricsMono:async function(){const t=getMonoPath(),{shedulersLink:e,dashesLink:o,moreInfoLink:s,keyPath:i}=t,l=n(i),[d,c,u]=await Promise.all([fetch(e,{method:"GET",headers:{Authorization:"Bearer "+l,"Content-Type":"application/json"}}).then(t=>{if(!t.ok)throw Error(`HTTP error! status: ${t.status}, name: responseShedulers`);return t}),fetch(o,{method:"GET",headers:{Authorization:"Bearer "+l,"Content-Type":"application/json"}}).then(t=>{if(!t.ok)throw Error(`HTTP error! status: ${t.status}, name: responseDashboards`);return t})]),[g,m]=await Promise.all([d.json(),c.json(),u?u.json():Promise.resolve(null)]),p=await a(l,g);return{dataShedulers:p,dataDashboards:m,dataAll:r(p,m),deadshedulers:checkerDeadshedulers(p,m)}}},methods:{getAccessToken:n,getShedulersMore:a,groupDatasets:r}},i={version:"1.0.0",api:{visi:s},lg:{async api(t,e="GET",n=null,a={}){const r=(new Date).toISOString(),s="req_"+Math.random().toString(36).substr(2,9);return console.groupCollapsed(`%cAPI ${e}%c ${t}`,o.API_REQUEST,o.API_REQUEST_TEXT),console.log("Request ID:",s),console.log("Timestamp:",r),console.log("Method:",e),console.log("URL:",t),n&&Object.keys(n).length>0&&console.log("Request Data:",n),a.headers&&console.log("Headers:",a.headers),console.groupEnd(),fetch(t,{method:e,body:n?JSON.stringify(n):void 0,headers:{"Content-Type":"application/json",...a.headers},...a}).then(async n=>{const a=n.headers.get("content-type")?.includes("application/json"),i=a?await n.json():await n.text(),l=n.ok?"SUCCESS":"ERROR",d=o.getStyleForStatus(l);if(console.groupCollapsed(`%cAPI ${l}%c ${t}`,d.badge,d.text),console.log("Response ID:",s),console.log("Status:",`${n.status} ${n.statusText}`),console.log("Response Time:",Date.now()-new Date(r).getTime()+"ms"),console.log("Response Type:",a?"JSON":"TEXT"),a&&i?console.log("Response Data:",i):i&&console.log("Response Text:",i),console.groupEnd(),!n.ok)throw{status:n.status,statusText:n.statusText,data:i,url:t,method:e,requestId:s};return{data:i,status:n.status,headers:n.headers,requestId:s}}).catch(e=>{const n=o.getStyleForStatus("ERROR");throw console.groupCollapsed("%cAPI ERROR%c "+t,n.badge,n.text),console.log("Response ID:",s),console.log("Status:",e.status||"NETWORK_ERROR"),console.log("Total Time:",Date.now()-new Date(r).getTime()+"ms"),console.log("Error Details:",e),e.data&&console.log("Error Data:",e.data),console.groupEnd(),{...e,requestId:s,timestamp:r}})},log:{success(t,...e){const n=o.getStyleForStatus("SUCCESS");console.log("%cSUCCESS%c "+t,n.badge,n.text,...e)},error(t,...e){const n=o.getStyleForStatus("ERROR");console.log("%cERROR%c "+t,n.badge,n.text,...e)},info(t,...e){const n=o.getStyleForStatus("INFO");console.log("%cINFO%c "+t,n.badge,n.text,...e)},warn(t,...e){const n=o.getStyleForStatus("WARNING");console.log("%cWARNING%c "+t,n.badge,n.text,...e)},debug(t,...e){const n=o.getStyleForStatus("DEBUG");console.log("%cDEBUG%c "+t,n.badge,n.text,...e)}}},frm:{v:t,d:e}};"undefined"!=typeof window?window.prxz=i:"undefined"!=typeof global?global.prxz=i:"undefined"!=typeof self&&(self.prxz=i),"undefined"!=typeof module&&module.exports&&(module.exports=i),"function"==typeof define&&define.amd&&define([],function(){return i})}();